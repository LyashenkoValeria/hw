# Сервер TFTP
В рамках данной работы был реализован сервер TFTP на Java.
Для реализации использовался [RFC: 1350](https://datatracker.ietf.org/doc/html/rfc1350).

https://github.com/LyashenkoValeria/ServerTFTP

## Формат пакета
TFTP поддерживает пять типов пакетов.
Заголовок TFTP пакета содержит код операции, связанный с этим пакетом.
```
            1     Read request (RRQ)
            2     Write request (WRQ)
            3     Data (DATA)
            4     Acknowledgment (ACK)
            5     Error (ERROR)
```
+ RRQ/WRQ пакет
```
            2 bytes     string    1 byte     string   1 byte
            ------------------------------------------------
           | Opcode |  Filename  |   0  |    Mode    |   0  |
            ------------------------------------------------
```
+ Пакет с данными
```
                   2 bytes     2 bytes      n bytes
                   ----------------------------------
                  | Opcode |   Block #  |   Data     |
                   ----------------------------------
```
+ Пакет подтверждения
```
                         2 bytes     2 bytes
                         ---------------------
                        | Opcode |   Block #  |
                         ---------------------
```
+ Пакет ошибки
```
               2 bytes     2 bytes      string    1 byte
               -----------------------------------------
              | Opcode |  ErrorCode |   ErrMsg   |   0  |
               -----------------------------------------
```

## Описание работы
TFTP - это простой протокол, который используется для передачи файлов.

Сервер TFTP может по запросу от клиента либо отправлять, либо принимать файлы.
Текущий запрос клиента определяется по коду операции в пришедшем пакете. 
Исходя из него, сервер запускает поток для чтения или для записи файла.

+ Запрос на чтение

Из пришедшего запроса извлекается имя файла. Сервер пытается прочитать данный файл. 
Если такого файла нет, то клиенту отправляется пакет с ошибкой.
В ином случае начинается отправка файла в виде пакетов с данными. 

После отправки каждого пакета с данными, сервер принимает пакет подтверждения, который содержит номер полученного клиентом пакета с данными.
Если номер в пакете подтверждения не совпадает с номером последнего отправленного пакета данных, то эти данные отсылаются повторно.
Отправка выполняется до тех пор, пока сервер не передаст весь файл или не закончатся попытки для переотправки данных.

+ Запрос на запись

Из пришедшего запроса также извлекается имя файла. 
Сервер проверяет, что такого файла ещё не существует и посылает пакет подтверждения с кодом 0. 
Если такой файл уже есть, то клиент получает пакет с ошибкой.

Процесс записи файла является обратным процессу чтения. 
Сервер получает пакеты с данными, сверяет номер пришедшего пакета и отправляет клиенту пакеты с подтверждением о получении.
Если номер ожидаемого пакета не совпадает с пришедшим, то требуется повторная отправка.

## Команды
+ `/stop` - остановка работы сервера

## Запуск
1. Клонируем репозиторий. 
2. Для запуска сервера в директории `ServerTFTP\out\artifacts\ServerTFTP_jar` вызываем 
   `java -jar ServerTFTP.jar`.
   
## Запрос от клиента(Windows)
+ `tftp -i 127.0.0.1 get fileName` - запрос на чтение файла
+ `tftp -i 127.0.0.1 put fileName` - запрос на запись файла