#Блокирующий TCP чат
Написан на Java.

[Блокирующий TCP чат](https://github.com/LyashenkoValeria/TCPchat/tree/master).

##Протокол
Подразумевает последовательность действий.
1. Установка соединения. Может быть только первым действием, в остальных ситуациях не является корректным.
2. Обмен сообщениями между клиентом и севером. Валидно в любой момент после действия 1 и до действия 4.
3. Обмен файлами между клиентом и сервером. Валидно в любой момент после действия 1 и до действия 4.
4. Закрытие соединения. Может быть выполнено только после действия 1.
##Формат пакета
###Клиент
+ Отправка имени клиента

client_name|time_zone|
|--- | --- |

+ Отправка сообщений

message|
|--- |

+ Отправка файлов

/file|file_name|file_length|file_bytes|
|--- | --- | --- | --- |
###Сервер
+ Отправка сообщений

time|client_name|message|
|--- | --- | --- |

+ Отправка файлов

/file|file_name|file_length|file_bytes|
|--- | --- | --- | --- |
##Команды
###Клиент
+ `/file` - отправка файла на сервер
+ `/quit` - выход клиента из чата
###Сервер
+ `/stop` - остановка работы сервера
##Описание работы чата
В начале запускается сервер, после чего клиенты пытаются подключиться к нему. 
У клиента запрашивается имя, которое затем отправляется на сервер вместе с временной зоной клиента. 
На сервере выполняется проверка, существует ли уже клиент с таким именем.
Если такой клиент уже есть, то сервер посылает сообщение `/refuse`. Клиенту требуется повторно ввести имя.
Если проверка прошла успешно, то всем, кроме нового клиента, приходит сообщение в формате `<HH:mm> [client_name]: Клиент client_name подключился` - о подключении нового клиента к чату.

После подключения клиент и сервер могут начать обмениваться сообщениями. 
Клиент может отправить обычное текстовое сообщение, файл или ввести команду `/quit`.

Если клиент отправил текстовое сообщение, то сервер отправляет его всем клиентам в формате `<HH:mm> [client_name]: text_message`.

Для отправки файлов клиенту необходимо ввести `/file Путь к файлу\\имя файла`. 
Если такой файл существует, то серверу будет отправлено сообщение, содержащее ключевое слово `/file`, имя файла и его размер.
После чего начнётся загрузка файла на сервер. Максимально допустимый размер файла - 5 Мб.
Если файл превышает данный размер, то он не будет отправлен на сервер, а клиент получить соответствующее сообщение.

Когда сервер получит весь файл, то он разошлёт его всем подключенным клиентам, кроме клиента-отправителя.
У клиента-получателя создаётся директория, в которую сохраняется присланный файл, и приходит уведомление о получении файла.

Если клиент отправил `/quit`, то его соединение закрывается, он отключается от сервера и остальные клиенты получают сообщение о его отключении - `<HH:mm> [client_name]: Клиент client_name отключен`.

Сервер также может завершить свою работу. При введении команды на сервере `/stop`, сервер разрывает соединение со всеми клиентами и завершает свою работу.
В этом случае клиенты также завершают свою работу.

##Запуск
1. Клонируем репозиторий. 
2. Для запуска сервера в директории `TCPchat\out\artifacts\ChatServer_jar` вызываем 
`java -jar ChatServer.jar`.
3. Для запуска клиента в директории `TCPchat\out\artifacts\ChatClient_jar` вызываем 
   `java -jar ChatClient.jar`.